<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 04 - Camera Capture</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        .container {
            position: relative;
            z-index: 10;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        .content-box {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        h1 {
            color: white;
            text-align: center;
            margin-top: 50px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 5px;
            background-color: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: scale(1.05);
        }
        .btn-stop {
            background-color: #f44336;
        }
        .btn-info {
            background-color: #2196F3;
        }
        .btn-view {
            background-color: #FF9800;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            background-color: rgba(231, 243, 255, 0.9);
            color: #000;
        }
        .error {
            background-color: rgba(255, 235, 238, 0.9);
            color: #c62828;
        }
        .success {
            background-color: rgba(232, 245, 233, 0.9);
            color: #2e7d32;
        }
        .files-container {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        .file-item {
            padding: 8px;
            margin: 5px 0;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .file-actions {
            display: flex;
            gap: 5px;
        }
        .file-action-btn {
            padding: 4px 8px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="parallax-container">
        <img src="/static/main_menu_assets/Flat_eyes.png" id="layer-back" alt="Background Layer">
        <img src="/static/main_menu_assets/L_eye.png" id="l_eye" alt="Middle Layer" class="eye">
        <img src="/static/main_menu_assets/R_eye.png" id="r_eye" alt="Middle Layer" class="eye">
        <img src="/static/main_menu_assets/Flat_eyes.png" id="layer-back_hue_adjustment" alt="Hue">
        <img src="/static/main_menu_assets/Top_mask.png" id="layer-front" alt="Foreground Layer">
        <img src="/static/main_menu_assets/viniette.png" id="viniette" alt="viniette">
        <img src="/static/main_menu_assets/glow.png" id="glow" alt="glow">
        <img src="/static/lab_03/round_icon.png" id="l3_icon" class="rotate" style="opacity: 0;">
    </div>

    <div class="container">
        <h1>Lab 04 - Camera Capture</h1>
        
        <div id="status" class="status">Ready</div>
        
        <div class="content-box">
            <div>
                <button class="btn" onclick="takeFrame()">Take Frame</button>
                <button class="btn" onclick="startRecording()">Start Recording</button>
                <button class="btn btn-stop" onclick="stopRecording()">Stop Recording</button>
                <button class="btn btn-info" onclick="checkCameraStatus()">Check Camera Status</button>
                <button class="btn btn-view" onclick="loadFiles()">Refresh Files</button>
            </div>
            
            <div id="result" style="margin-top: 20px;"></div>
            
            <div class="files-container">
                <h3>Captured Files</h3>
                <div id="filesList"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // Parallax effect
        document.addEventListener('mousemove', (e) => {
            const layerBack = document.getElementById('layer-back');
            const lEye = document.getElementById('l_eye');
            const rEye = document.getElementById('r_eye');
            const layerFront = document.getElementById('layer-front');
            const glow = document.getElementById('glow');
            
            const x = (window.innerWidth - e.pageX * 2) / 100;
            const y = (window.innerHeight - e.pageY * 2) / 100;
            
            layerBack.style.transform = `translateX(${x}px) translateY(${y}px)`;
            lEye.style.transform = `translateX(${-x}px) translateY(${-y}px)`;
            rEye.style.transform = `translateX(${-x}px) translateY(${-y}px)`;
            layerFront.style.transform = `translateX(${x/2}px) translateY(${y/2}px)`;
            glow.style.transform = `translateX(${x}px) translateY(${y}px)`;
        });

        function updateStatus(message, isError = false) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + (isError ? 'error' : 'success');
        }

        function displayResult(message, isError = false) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p><strong>Result:</strong> ' + message + '</p>';
        }

        async function takeFrame() {
            updateStatus('Taking frame...');
            try {
                const response = await fetch('/takeFrame');
                const data = await response.json();
                
                if (data.status === 200) {
                    updateStatus('Frame taken successfully!');
                    displayResult(data.message);
                    loadFiles(); // Refresh the file list
                } else {
                    updateStatus('Failed to take frame!', true);
                    displayResult(data.message, true);
                }
            } catch (error) {
                updateStatus('Error taking frame!', true);
                displayResult('Error: ' + error.message, true);
            }
        }

        async function startRecording() {
            updateStatus('Starting recording...');
            try {
                const response = await fetch('/startRecording?filename=static/output/recording_' + Date.now() + '.avi&fps=30');
                const data = await response.json();
                
                if (data.status === 200) {
                    updateStatus('Recording started!');
                    displayResult(data.message);
                } else {
                    updateStatus('Failed to start recording!', true);
                    displayResult(data.message, true);
                }
            } catch (error) {
                updateStatus('Error starting recording!', true);
                displayResult('Error: ' + error.message, true);
            }
        }

        async function stopRecording() {
            updateStatus('Stopping recording...');
            try {
                const response = await fetch('/stopRecording');
                const data = await response.json();
                
                if (data.status === 200) {
                    updateStatus('Recording stopped successfully!');
                    displayResult(data.message);
                    loadFiles(); // Refresh the file list
                } else {
                    updateStatus('Failed to stop recording!', true);
                    displayResult(data.message, true);
                }
            } catch (error) {
                updateStatus('Error stopping recording!', true);
                displayResult('Error: ' + error.message, true);
            }
        }

        async function checkCameraStatus() {
            updateStatus('Checking camera status...');
            try {
                const response = await fetch('/isCameraOpen');
                const data = await response.json();
                
                if (data.status === 200) {
                    const isOpen = data.message === 'true';
                    const status = isOpen ? 'Camera is open' : 'Camera is closed';
                    updateStatus(status);
                    displayResult(status);
                } else {
                    updateStatus('Failed to get camera status!', true);
                    displayResult(data.message, true);
                }
            } catch (error) {
                updateStatus('Error checking camera status!', true);
                displayResult('Error: ' + error.message, true);
            }
        }

        async function loadFiles() {
            try {
                const response = await fetch('/getCapturedFiles');
                const data = await response.json();
                
                if (data.status === 200) {
                    const filesList = document.getElementById('filesList');
                    filesList.innerHTML = '';
                    
                    if (data.files && data.files.length > 0) {
                        data.files.forEach(file => {
                            const fileItem = document.createElement('div');
                            fileItem.className = 'file-item';
                            
                            const fileName = document.createElement('span');
                            fileName.textContent = file.name;
                            
                            const actions = document.createElement('div');
                            actions.className = 'file-actions';
                            
                            const viewBtn = document.createElement('button');
                            viewBtn.className = 'btn file-action-btn';
                            viewBtn.textContent = 'View';
                            viewBtn.onclick = () => window.open('/static/output/' + file.name, '_blank');
                            
                            const downloadBtn = document.createElement('button');
                            downloadBtn.className = 'btn file-action-btn btn-info';
                            downloadBtn.textContent = 'Download';
                            downloadBtn.onclick = () => window.location.href = '/static/output/' + file.name;
                            
                            actions.appendChild(viewBtn);
                            actions.appendChild(downloadBtn);
                            
                            fileItem.appendChild(fileName);
                            fileItem.appendChild(actions);
                            filesList.appendChild(fileItem);
                        });
                    } else {
                        filesList.innerHTML = '<p>No captured files found.</p>';
                    }
                } else {
                    document.getElementById('filesList').innerHTML = '<p>Failed to load files.</p>';
                }
            } catch (error) {
                document.getElementById('filesList').innerHTML = '<p>Error loading files: ' + error.message + '</p>';
            }
        }

        // Load files when the page loads
        window.onload = function() {
            loadFiles();
        };
    </script>
</body>
</html>

<!-- 
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAB 04</title>
    <link rel="stylesheet" href="/static/lab04.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Dots&display=swap" rel="stylesheet">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon" />
</head>

<body>
    <div class="parallax-container">
        <img src="/static/lab_04/background.png" id="layer-back" alt="Background Layer">
        <img src="/static/lab_04/foreground.png" id="head" alt="Hue">
        <img src="/static/lab_04/fx.png" id="fx" alt="glow">
    </div>

    <div class="main-container">
        <button onclick="location.href='/'" class="home-button">âŒ‚</button>
        <!-- From Uiverse.io by Rodrypaladin --> 
        
    </div>
    <div id="cursor-coords" style="visibility: hidden;">Cursor Position: </div>
    <div id="screen-dimensions" style="visibility: hidden;">Screen Dimensions: </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="/static/lab04.js"></script>
</body>

</html> -->